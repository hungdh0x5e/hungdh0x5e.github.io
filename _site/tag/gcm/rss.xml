<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>https://hungdh.me/</title>
   
   <link>https://hungdh.me/</link>
   <description>A beautiful narrative written with the world's most elegant publishing platform. The story begins here.</description>
   <language>en-uk</language>
   <managingEditor> Đỗ Huy Hùng</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>Triển khai GCM với Android</title>
	  <link>//Trien-khai-GCM-voi-Android-part1</link>
	  <author>Đỗ Huy Hùng</author>
	  <pubDate>2016-01-14T17:18:00+07:00</pubDate>
	  <guid>//Trien-khai-GCM-voi-Android-part1</guid>
	  <description><![CDATA[
	     <p>Bạn có một ứng dụng, bạn muốn gửi thông báo cho tất cả client mà không muốn mất phí.
Điều đó hoàn toàn có thể thực hiện được nếu bạn sử dụng dịch vụ Google Cloud Messaging (GCM) do Google cung cấp.
GCM là dịch vụ giúp bạn tương tác giữa client - server thông qua máy chủ GCM.
Trong bài viết này, mình sẽ giới thiệu, hướng dẫn các bạn các bước cơ bản để xây dựng ứng dụng Android sử dụng GCM (bao gồm cả client lẫn server).</p>

<h2 id="m-hnh-cch-vn-hnh-ca-gcm">1. Mô hình, cách vận hành của GCM</h2>
<p><img src="/assets/images/2016/01/gcm-diagram.png" alt="Sơ đồ vận hành của GCM" /></p>

<p>Quá trình hoạt động như sau:</p>

<ol>
  <li>Client gửi <code class="highlighter-rouge">senderID</code>, <code class="highlighter-rouge">application id</code> tới <code class="highlighter-rouge">GCM server</code> để đăng kí.</li>
  <li>Nếu các thông số hợp lệ, <code class="highlighter-rouge">GCM server</code> sẽ trả về <code class="highlighter-rouge">registration id</code> cho client.</li>
  <li>Sau khi nhận được <code class="highlighter-rouge">registration id</code> mà <code class="highlighter-rouge">GCM server</code> trả về, client sẽ  gửi <code class="highlighter-rouge">registration id</code> này lên server (do ta tự xây dựng).</li>
  <li>Server nhận <code class="highlighter-rouge">registration id</code> và lưu nó vào CSDL (phục vụ cho việc quản lý, gửi thông báo sau này).</li>
  <li>Mỗi khi muốn thông báo tới client, server sẽ gửi yêu cầu tới <code class="highlighter-rouge">GCM server</code> với danh sách các <code class="highlighter-rouge">registration id</code>.</li>
  <li><code class="highlighter-rouge">GCM server</code> sẽ thông báo tin nhắn tới các client (dựa vào <code class="highlighter-rouge">registration id</code> mà server cung cấp).</li>
</ol>

<p><strong>Đăng kí với Google Cloud Messaging</strong></p>

<p>Để có được <code class="highlighter-rouge">senderID</code>, <code class="highlighter-rouge">application id</code> hãy làm như sau:</p>

<ol>
  <li>Truy cập tới: <a href="https://developers.google.com/mobile/add?platform=android&amp;cntapi=gcm">https://developers.google.com/mobile/</a> để tạo nhanh project.</li>
  <li>
    <p>Tại đây, bạn cần nhập <code class="highlighter-rouge">App name</code> và <code class="highlighter-rouge">package name</code> vào khung tương ứng. Sau đó chọn tiếp tục.
<img src="/assets/images/2016/01/gcm-registration-api-1.png" alt="Đăng kí API cho ứng dụng" /></p>
  </li>
  <li>Ở bước này, bạn sẽ bật các API dùng cho ứng dụng của mình (ở đây chỉ demo GCM nên mình chỉ bật Cloud Messaging) bằng cách nhấn vào <code class="highlighter-rouge">Enable Cloud Messaging</code>.
Kết quả thu được:
<img src="/assets/images/2016/01/gcm-registration-api-2.png" alt="Đăng kí API cho ứng dụng" />
Bạn có thể thấy 2 giá trị mà mình cần sử dụng: <strong>Server API Key</strong> (đươc sử dụng khi server gửi yêu cầu tới GCM server), <strong>Sender ID</strong> (dùng cho client).</li>
  <li>Nhấn <code class="highlighter-rouge">Generate configuration files</code> để tạo file <code class="highlighter-rouge">google-service.json</code>, đây là file config được sử dụng tại client.
Cuối cùng là tải file <code class="highlighter-rouge">google-service.json</code>, và di chuyển vào thư mục <code class="highlighter-rouge">/app/</code> trong project của bạn.</li>
</ol>

<p>Bạn có thể tham khảo tài liệu hướng dẫn chính thức của Google <a href="https://developers.google.com/cloud-messaging/android/client?configured=true">tại đây</a></p>

<h2 id="trin-khai-ng-dng">2. Triển khai ứng dụng.</h2>

<p>Trong bài viết này, mình sẽ hướng dẫn xây dựng server side trước, phía client sẽ có trong bài viết tiếp theo.</p>

<h3 id="xy-dng-server-side">2.1 Xây dựng Server side</h3>

<p>Trong tutorial này, mình sẽ sử dụng <code class="highlighter-rouge">PHP</code> để xây dựng server cũng như <code class="highlighter-rouge">MySQL</code> làm cơ sở dữ liệu.</p>

<p><strong>Xây dựng CSDL</strong></p>

<ol>
  <li>Mở phpmyadmin để tạo database với tên là <code class="highlighter-rouge">gcm</code>.</li>
  <li>Vào database <code class="highlighter-rouge">gcm</code> và truy vấn câu query dưới để tạo bảng <code class="highlighter-rouge">gcm_users</code>
<script src="https://gist.github.com/hungdh0x5e/9feae65b241f36fb248e.js"></script></li>
</ol>

<p><strong>Xây dựng server</strong></p>

<ol>
  <li>Tạo file <code class="highlighter-rouge">config.php</code> để lưu thông tin về database và google api key.
<script src="https://gist.github.com/hungdh0x5e/d672489ff2c48cb70ea7.js"></script></li>
  <li>Một file khác <code class="highlighter-rouge">[db_connect.php](https://gist.github.com/hungdh0x5e/3383e5f729c5053d72db)</code> để tiến hành kết nối với CSDL (bao gồm việc open và close).
<script src="https://gist.github.com/hungdh0x5e/3383e5f729c5053d72db.js"></script></li>
  <li>File <code class="highlighter-rouge">db_functions.php</code> chứa các phương thức thao tác với CSDL như thêm mới (storeUser), lấy toàn bộ danh sách user (getAllUsers). 
Bạn có thể xem nội dung chi tiết <a href="https://gist.github.com/hungdh0x5e/6f04d2e4b205d440ac1d">tại đây</a>;</li>
  <li>File <code class="highlighter-rouge">GCM.php</code> dùng để gửi yêu cầu thông báo tới GCM server.
<script src="https://gist.github.com/hungdh0x5e/ff98e4007e4aec0b2aba.js"></script></li>
  <li>Tạo file <code class="highlighter-rouge">register.php</code> để nhận truy vấn từ client, và lưu trữ thông tin vào trong CSDL. 
Các tham số client cần phải gửi <code class="highlighter-rouge">name</code>, <code class="highlighter-rouge">email</code>, <code class="highlighter-rouge">registration id</code>.
<script src="https://gist.github.com/hungdh0x5e/77c3836a45b76f9e58fa.js"></script></li>
  <li>Tạo file <code class="highlighter-rouge">send_message.php</code> để gửi thông báo tới client thông qua GCM server.
<script src="https://gist.github.com/hungdh0x5e/76ff3d300b1007d92de0.js"></script></li>
  <li>Cuối cùng là tạo file <code class="highlighter-rouge">index.php</code> có nhiệ̣m vụ̣ hiể̉n thị̣ danh sách các client đã đăng kí , và cho phép gửi tin nhắn tới từng thiết bị̣. Do code khá dài nên mình sẽ dẫn link để các bạn tham khảo.
<a href="https://gist.github.com/hungdh0x5e/a193f86ddbe2c234ba99">index.php</a></li>
</ol>

<p>Như vậy là đã xây dựng xong server side, giao diện quản lý sẽ tương tự như sau
<img src="/assets/images/2016/01/gcm-admin.png" alt="Giao diện quản lý" /></p>

<p><strong>Lưu ý:</strong> Chỉ xây dựng <code class="highlighter-rouge">client side</code> khi bạn đã xây dựng <code class="highlighter-rouge">server side</code> thành công.</p>

<p>Trong bài viết tiếp theo, mình sẽ hướng dẫn cách xây dựng phía <code class="highlighter-rouge">client</code>.</p>

<p>Toàn bộ code phần server bạn có thể tham khảo <a href="https://github.com/hungdh0x5e/GoogleCloudMessaging/tree/master/gcm">tại đây</a></p>

	  ]]></description>
	</item>


</channel>
</rss>
