<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Tìm hiểu nginx</title>
    <meta name="description" content="If you can't explain it simply, you don't understand it well enought" />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="//tim-hieu-ve-nginx" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Huy Hùng" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Tìm hiểu nginx" />
    <meta property="og:description" content="If you can't explain it simply, you don't understand it well enought" />
    <meta property="og:url" content="//tim-hieu-ve-nginx" />
    <meta property="og:image" content="/assets/images/2016/06/nginx.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Tìm hiểu nginx" />
    <meta name="twitter:description" content="If you can't explain it simply, you don't understand it well enought" />
    <meta name="twitter:url" content="//tim-hieu-ve-nginx" />
    <meta name="twitter:image:src" content="/assets/images/2016/06/nginx.png" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Huy Hùng",
    "name": "Tìm hiểu nginx",
    "url": "//tim-hieu-ve-nginx",
    "image": "/assets/images/2016/06/nginx.png",
    "description": "If you can't explain it simply, you don't understand it well enought"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Huy Hùng" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-fables " role="presentation"><a href="/tag/fables">Fables</a></li>
        <li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>
        <li class="nav-author " role="presentation"><a href="/author/hungdh">HungDH</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/2016/06/nginx.png) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-content">

        <header class="post-header">
            <h1 class="post-title">Tìm hiểu nginx</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/hungdh'>Huy Hùng</a>
                
            
            <time class="post-date" datetime="2016-07-18">18 Jul 2016</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/content'>Content</a>,
                    
                
                    
                       <a href='/tag/nginx'>Nginx</a>
                    
                
                
            </section>
        </header>
        <section class="post-content">

            <h4 id="i-nginx-là-gì-">I. Nginx là gì ?</h4>

<ol>
  <li><strong>Khái niệm</strong>
    <ul>
      <li>Nginx (engine x) là một web server (tương tự apache), vượt trội về khả năng xử lý các file tĩnh so với apache (mạnh về xử lý các file động). Nó có thể đóng vai trò là một reverse proxy cho các giao thức: HTTP, HTTPS, IMAP, POP3, SMTP cũng như hỗ trợ cân bằng tải (load balancer).</li>
      <li>Nginx được viết bởi <a href="http://sysoev.ru/en/">Igor Sysoev</a>, được công bố năm 2002. Nginx chạy trên Unix, Linux, các biến thể BSD, Mac OS X, Solaris, AIX, HP-UX và Microsoft Windows.</li>
    </ul>
  </li>
  <li><strong>Tính năng</strong></li>
</ol>

<p>a. Basic HTTP server features</p>

<ul>
  <li>Xử lý các file tĩnh và file index, tự động đánh index</li>
  <li>Tăng tốc reverse proxy với việc caching, cân bằng tải (load banlancing), khả năng chịu lỗi (fault tolerance)</li>
  <li>Hỗ trợ tăng tốc caching với FastCGI, SCGI, uwsgi</li>
  <li>Hỗ trợ giao thức SSL, TLS SNI, HTTP/2</li>
  <li>Tạo virtual host</li>
  <li>Giới hạn số kết nối, yêu cầu từ một địa chỉ IP</li>
  <li>Kiểm soát truy cập bởi: địa chỉ IP, mật khẩu (HTTP basic authentication) và từ các yêu cầu con (subrequest)</li>
</ul>

<p>b. TCP/UDP proxy server features</p>

<ul>
  <li>Load balancing and fault tolerance</li>
  <li>Access control based on client address</li>
</ul>

<p>c. Mail proxy server features</p>

<ul>
  <li>Chứng thực người dùng sử dụng HTTP authentication và chuyển hướng kết nối tới SMTP server bên trong.</li>
  <li>Hỗ trợ: POP3, IMAP, SMTP, SSL, STARTTLS and STLS</li>
</ul>

<h4 id="ii-cài-đặt-cấu-hình-virtual-host">II. Cài đặt, cấu hình virtual host</h4>

<p>Cài đặt nginx:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>nginx
</code></pre></div></div>

<p><em>Core Context</em></p>

<h5 id="the-main-context">The main context</h5>

<p>Tên gọi phổ biến là <code class="language-plaintext highlighter-rouge">main</code> hay <code class="language-plaintext highlighter-rouge">global</code> context. Đây là context duy nhất mà không chứa trong bất kì context (context block) nào khác.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The main context is here, outside any other contexts</span>
<span class="n">context</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Các thông số phổ biến trong main context: the number of workers, the file to save the main process’s ID</p>

<h5 id="the-event-context">The event context</h5>

<p>Chứa trong <code class="language-plaintext highlighter-rouge">main context</code>, được sử dụng để thiết lập các global option ảnh hưởng đến cách nginx xử lý các kết nối chung. Và context này là duy nhất trong nginx configure</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>events {
    worker_connections 768;
    # multi_accept on;
}
</code></pre></div></div>

<h5 id="the-http-context">The HTTP context</h5>

<p>Trong khi cấu hình nginx như một web server hay reverse proxy, <code class="language-plaintext highlighter-rouge">http</code> context sẽ giữ đa số các cấu hình. Context này sẽ chứa tất cả các tiêu chí, các context cần thiết khác để định nghĩa cách chương trình sẽ handle các kết nối HTTP, HTTPS. Và nó ngang hàng với <code class="language-plaintext highlighter-rouge">event context</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http {
   ...
}
</code></pre></div></div>

<p>Một vài tiêu chí:</p>

<ul>
  <li>Đường dẫn cho log (<code class="language-plaintext highlighter-rouge">access_log</code>, <code class="language-plaintext highlighter-rouge">error_log</code>)</li>
  <li>Cấu hình hiển thị khi server lỗi (<code class="language-plaintext highlighter-rouge">error_page</code>)</li>
  <li>Tiêu chí nén (<code class="language-plaintext highlighter-rouge">gzip</code>, <code class="language-plaintext highlighter-rouge">gzip_disable</code>)</li>
  <li>TCP keep alive (<code class="language-plaintext highlighter-rouge">keepalive_disable</code>, <code class="language-plaintext highlighter-rouge">keepalive_requests</code>, <code class="language-plaintext highlighter-rouge">keepalive_timeout</code>)</li>
  <li>Các luật (rule) mà Nginx sẽ làm theo để cố gắng tối ưu hóa gói tin và system call (<code class="language-plaintext highlighter-rouge">sendfile</code>, <code class="language-plaintext highlighter-rouge">tcp_nodelay</code>, <code class="language-plaintext highlighter-rouge">tcp_nopush</code>)</li>
  <li>Thư mục chứa website (<code class="language-plaintext highlighter-rouge">root</code>), index file (<code class="language-plaintext highlighter-rouge">index</code>)</li>
</ul>

<h5 id="the-server-context">The Server context</h5>

<p>Được định nghĩa bên trong <code class="language-plaintext highlighter-rouge">http context</code>. Đây là phần giúp ta cấu hình virtual host.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">listen</code>: Địa chỉ IP, port được thiết kế để nhận response. Nếu yêu cầu từ client có giá trị trùng với trường này, block này sẽ được lựa chọn để xử lý kết nối.</li>
  <li><code class="language-plaintext highlighter-rouge">server_name</code>: để kiểm tra map với domain từ request, nếu trùng sẽ đẩy request đến host này.</li>
  <li>Ngoài ra còn có một số tiêu chí (có thể định nghĩa trong <code class="language-plaintext highlighter-rouge">http context</code>) như logging, document root, compression, …</li>
</ul>

<h5 id="the-location-context">The Location context</h5>

<p><code class="language-plaintext highlighter-rouge">Location context</code> chứa các config ứng với mỗi khu vực trong <code class="language-plaintext highlighter-rouge">server context</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server {
    server_name example.com;

    location /upload {
        ...
    }

    location /admin {
        ...
    }
}
</code></pre></div></div>

<p>Như example trên, khi người dùng truy cập vào url <code class="language-plaintext highlighter-rouge">http://example.com/upload</code> sẽ map với các rule trong location <code class="language-plaintext highlighter-rouge">upload</code>. Tương tự với location <code class="language-plaintext highlighter-rouge">admin</code>. Điều này giúp ta có thể thiết lập các chính sách truy cập phù hợp với từng khu vực.</p>

<p>VD:</p>

<ul>
  <li>Cấm mọi truy cập tới khu vực <code class="language-plaintext highlighter-rouge">admin</code> trừ các IP trong dải mạng <code class="language-plaintext highlighter-rouge">192.168.1.0/24</code></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location /admin {
    allow 192.168.1.0/24;
    deny all;
}
</code></pre></div></div>

<p>Các tiêu chí xuất hiện trong <code class="language-plaintext highlighter-rouge">location context</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">root /data;</code>: thêm đường dẫn.</li>
  <li><code class="language-plaintext highlighter-rouge">proxy_pass $IP_proxy</code>: chuyển request tới $IP_proxy - sử dụng để thiết lập nginx như reverse proxy</li>
  <li><code class="language-plaintext highlighter-rouge">return 404;</code>: return status code, or redirect <code class="language-plaintext highlighter-rouge">return 301 http://www.example.com/moved/here;</code></li>
  <li><code class="language-plaintext highlighter-rouge">rewrite</code>: rewrite url</li>
  <li><code class="language-plaintext highlighter-rouge">sub_filter</code> : rewrite HTTP response</li>
</ul>

<p>Reference:</p>
<ul>
  <li><a href="https://docs.nginx.com/nginx/admin-guide/web-server/web-server/">Nginx web-server</a></li>
  <li><a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#variables">nginx-http-core</a></li>
</ul>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/hungdh" style="background-image: url(/assets/images/hungdh.png)"><span class="hidden">hungdh's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/hungdh">Huy Hùng</a></h4>

                        
                            <p> I'm backend developer with Golang, Ruby on Rails.<br>With a keen interest in command-line interfaces: terminal & tmux, Zsh & Neovim<br>And many other high-end technology stuff...</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Ha Noi, VN</span>
                            <span class="author-link icon-link"><a href="https://hungdh.dev"> hungdh.dev</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Tìm hiểu nginx&amp;url=tim-hieu-ve-nginx"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=tim-hieu-ve-nginx"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=tim-hieu-ve-nginx"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/cover2.jpg)" href="/hello-world">
            <section class="post">
                <h2>Hello World</h2>
                <p>> Hello World! > If you can't explain it simply, you don't understand it well...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/2016/01/gcm.gif)" href="/trien-khai-gcm-voi-android-phan-2">
            <section class="post">
                <h2>Triển khai GCM với Android (phần 2)</h2>
                <p>Ở phần một, mình đã giới thiệu GCM và hướng dẫn xây dựng được server...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Huy Hùng</a> &copy; 2023</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyllt/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-69281367-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
